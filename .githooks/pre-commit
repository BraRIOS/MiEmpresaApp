#!/bin/sh
# Hook pre-commit para verificar ktlint antes de commitear

echo "üîç Ejecutando ktlint en archivos Kotlin modificados..."

# Obtener archivos Kotlin staged
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep '\.kt$')

if [ -z "$STAGED_FILES" ]; then
    echo "‚úÖ No hay archivos Kotlin para verificar"
    exit 0
fi

echo "Archivos a verificar:"
echo "$STAGED_FILES"
echo ""

# Ejecutar ktlint
./gradlew ktlintCheck --daemon

RESULT=$?

if [ $RESULT -ne 0 ]; then
    echo ""
    echo "‚ùå ktlint encontr√≥ problemas de formato."
    echo "üí° Puedes auto-corregirlos ejecutando: ./gradlew ktlintFormat"
    echo "   O puedes hacer commit con --no-verify para saltarte esta verificaci√≥n"
    exit 1
fi

echo "‚úÖ ktlint pas√≥ exitosamente!"
exit 0
